# =============================================================================
# Bestway Spa ESPHome Configuration - Model 54138 (NO54138)
# =============================================================================
# For 4-wire UART protocol spas
#
# Features: Bubbles (air), HydroJets
#
# Hardware: ESP8266 D1 Mini connected to spa's 4-wire bus
#
# Pin Configuration:
#   UART Connection:
#     - TX: GPIO1 (or any GPIO for SoftwareSerial)
#     - RX: GPIO3 (or any GPIO for SoftwareSerial)
# =============================================================================

substitutions:
  device_name: bestway-spa
  friendly_name: "Bestway Spa"

esphome:
  name: ${device_name}
  friendly_name: ${friendly_name}

esp8266:
  board: d1_mini

# Enable logging
logger:
  level: INFO
  baud_rate: 0  # Disable logging on UART0 since we use it for spa

# Enable Home Assistant API
api:
  encryption:
    key: !secret api_encryption_key

ota:
  - platform: esphome
    password: !secret ota_password

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  ap:
    ssid: "${device_name}-fallback"
    password: !secret ap_password

captive_portal:

# Web server for local access
web_server:
  port: 80

# UART for spa communication
uart:
  id: spa_uart
  tx_pin: GPIO1
  rx_pin: GPIO3
  baud_rate: 9600

# Bestway Spa component - 54138 4-wire UART
external_components:
  - source:
      type: local
      path: components

climate:
  - platform: bestway_spa
    id: spa
    name: "${friendly_name}"
    uart_id: spa_uart

    # Model configuration - 54138 uses 4-wire UART protocol
    protocol_type: 4WIRE
    model: 54138

    # Sensors
    current_temperature:
      name: "${friendly_name} Current Temperature"

    # Binary sensors for state monitoring
    heating:
      name: "${friendly_name} Heating"
    filter:
      name: "${friendly_name} Filter Pump"
    bubbles:
      name: "${friendly_name} Bubbles"
    jets:
      name: "${friendly_name} HydroJets"
    locked:
      name: "${friendly_name} Locked"
    power:
      name: "${friendly_name} Power"
    error:
      name: "${friendly_name} Error"

    # Text sensors
    error_text:
      name: "${friendly_name} Error Code"
    display_text:
      name: "${friendly_name} Display"

# Control switches (has both jets and bubbles)
switch:
  - platform: bestway_spa
    spa_id: spa
    heater:
      name: "${friendly_name} Heater"
    filter:
      name: "${friendly_name} Filter"
    bubbles:
      name: "${friendly_name} Air Jets"
    jets:
      name: "${friendly_name} HydroJets"
    lock:
      name: "${friendly_name} Lock"
    power:
      name: "${friendly_name} Power"
    unit:
      name: "${friendly_name} Unit (C/F)"

# Restart button
button:
  - platform: restart
    name: "${friendly_name} Restart"
